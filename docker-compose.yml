services:
  # 1. Backend-for-Frontend (API)
  bff:
    build:
      context: ./backend
      dockerfile: Dockerfile
    command: /bin/bff
    ports:
      - "8080:8080"
    environment:
      - DATABASE_URL=/data/merchant.db
      - PORT=8080
    volumes:
      - ./data:/data
    restart: always

  # 2. Manager (Sync/Arb Logic)
  manager:
    build:
      context: ./backend
      dockerfile: Dockerfile
    command: /bin/manager
    environment:
      - DATABASE_URL=/data/merchant.db
    volumes:
      - ./data:/data
    restart: always

  # 3. Trader (Execution Logic)
  trader:
    build:
      context: ./backend
      dockerfile: Dockerfile
    command: /bin/trader
    environment:
      - DATABASE_URL=/data/merchant.db
    volumes:
      - ./data:/data
    restart: always

  # 4. Frontend (Vite/TanStack)
  # In production, you'd usually serve this via Nginx, 
  # but this setup runs the dev/preview server for testing.
  frontend:
    build:
      context: ./frontend
    ports:
      - "5173:5173"
    environment:
      - VITE_API_URL=http://localhost:8080
    restart: always
